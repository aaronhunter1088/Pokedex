<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
<head>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="icon" type="image/x-icon" href="/images/pokeball.jpg"/>
    <title>Pokedex</title>
    <style>
        html {
            <!-- background-image: url(); -->
            background-position: center center;
            background-repeat:  no-repeat;
            background-attachment: fixed;
            background-size:  cover;
        }
        <!-- NEEDED -->
        body {
            display: block;
            margin: 8px;
            background-position: center center;
            background-repeat:  no-repeat;
            background-attachment: fixed;
            background-size:  cover;
        }
        .button {
            font-weight: bold;
        }
        .cursor {
            cursor:pointer;
        }
        .center {
            padding: 70px 0;
            text-align: center;
            vertical-align: middle;
        }
        h1 {
            /*padding: 70px 0;*/
            text-align: center;
            line-height: 1.5;
            display: inline-block;
            vertical-align: middle;
        }
    </style>
    <!-- jQuery -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
    <link rel="stylesheet" href="//code.jquery.com/ui/1.12.1/themes/base/jquery-ui.css">
    <script src="https://code.jquery.com/ui/1.12.1/jquery-ui.js"></script>
    <!-- Latest compiled and minified CSS -->
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/3.4.1/css/bootstrap.min.css">
    <!-- Optional theme -->
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/3.4.1/css/bootstrap-theme.min.css">
    <!-- Latest compiled and minified JavaScript -->
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/3.4.1/js/bootstrap.min.js"></script>
    <!-- JavaScript Bundle with Popper -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.0/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-gH2yIJqKdNHPEq0n4Mqa/HGKIhSkIHeL5AyhkYV8i59U5AR6csBvApHHNl/vI1Bx" crossorigin="anonymous">
</head>

<body style="justify-content:space-evenly;text-align: center;">
    <h1 id="title" style="vertical-align: middle;">
        This is your
        <span class="center"><img alt="pokedex" src="/images/pokedexImage.jpg" height=150></span>
    </h1>
    <br>
    <h4 style="vertical-align: middle;">
        <label id="nameLabel" for="pokemonName">Pokemon Name/ID</label> <input id="pokemonName" type="text"/>
        <input id="pokemonBtn" type="button" onclick="getPokemonInfo();" class="button cursor" value="Get Info"/>
    </h4>
    <br>
    <div id="pokedex" style="display:inline-flex;">
        <div style="display:flow;">
            <h1 id="infoTitle">Pokemon Info</h1>
            <div id="info" style="display:flow; width:300px;">
                <div id="idAndName" style="display:inline-flex;">
                    <label for="idOfPokemon">ID:</label> <h3 id="idOfPokemon"></h3> &nbsp;
                    <label for="nameOfPokemon">Name:</label> <h3 id="nameOfPokemon"></h3>
                </div>
                <br>
                <div id="hAndW" style="display:inline-flex;">
                    <label for="heightOfPokemon">Height:</label> <h3 id="heightOfPokemon"></h3> &nbsp;
                    <label for="weightOfPokemon">Weight:</label> <h3 id="weightOfPokemon"></h3>
                </div>
                <br>
                <div id="colorAndType" style="display:inline-flex;">
                    <label for="colorOfPokemon">Color:</label> <h3 id="colorOfPokemon"></h3> &nbsp;
                    <label for="typeOfPokemon">Type:</label> <h3 id="typeOfPokemon"></h3>
                </div>
                <h3 id="description"></h3>
            </div>
            <div id="imageAndImageBtns">
                <div id="photosDiv">
                    <input id="pokemonDefaultImgBtn" type="button" onclick="showImage('default');" class="button cursor" value="Show default"/>
                    <input id="pokemonShinyImgBtn" type="button" onclick="showImage('shiny');" class="button cursor" value="Show shiny"/>
                </div>
                <img id="imageOfPokemon" alt="pokemon" src="#" width="300" height="300"/>
            </div>
        </div>
    </div>
    <script type="text/javascript">
        $(function(){
            $('#pokedex').hide();
        });
        // Actions performed when you click "Get Info"
        function getPokemonInfo() {
            let name = $('#pokemonName').val();
            if (!isNameValid(name)) { alert("Not a valid name or ID"); }
            else {
                getPokemon(name);
                getPokemonDescriptionText(name);
                changeBackgroundColor(name);
                $('#pokedex').show();
            }
        }
        var pokemon = {}, sprites = {}, species = {};
        // Ajax to get Pokemon
        function getPokemon(name) {
            $.ajax({
                headers: {
                    accept: "application/json",
                    contentType: "application/json"
                },
                type: "GET",
                url: "/pokedex/pokemon/"+name,
                async: false,
                dataType: "application/json",
                crossDomain: true,
                statusCode: {
                    200: function(data) {
                        pokemon = JSON.parse(data.responseText);
                        //console.log(name + ": " + JSON.stringify(pokemon));
                        sprites = pokemon["sprites"];
                        //console.log("sprites: " + JSON.stringify(sprites));
                        $('#idOfPokemon').text(pokemon.id);
                        $('#nameOfPokemon').text(pokemon.name.charAt(0).toUpperCase() + pokemon.name.slice(1));
                        showImage('default');
                        $('#heightOfPokemon').text(pokemon.height);
                        $('#weightOfPokemon').text(pokemon.weight);
                        let pokemonTypes = pokemon.types;
                        if (pokemonTypes.length > 1) {
                            $('#typeOfPokemon').text(pokemonTypes[0].type.name + " and " + pokemonTypes[1].type.name);
                        } else {
                            $('#typeOfPokemon').text(pokemonTypes[0].type.name);
                        }
                    },
                    400: function() {
                        $('#pokedex').hide();
                    },
                    404: function(data) {
                        console.log(JSON.stringify(data));
                    },
                    405: function(data) {
                        console.log(JSON.stringify(data));
                    },
                    500: function(data) {
                        console.log(JSON.stringify(data));
                    }
                }
            })
        }
        // Ajax to get Description text
        function getPokemonDescriptionText(name) {
            $.ajax({
                headers: {
                    accept: "application/json",
                    contentType: "application/json"
                },
                type: "GET",
                url: "pokedex/"+name+"/description",
                async: false,
                dataType: "application/json",
                crossDomain: true,
                statusCode: {
                    200: function(data) {
                        $('#description').text(data.responseText);
                    },
                    400: function(data) {
                        $('#description').text(data.responseText);
                    },
                    404: function(data) {
                        console.log(JSON.stringify(data));
                    },
                    405: function(data) {
                        console.log(JSON.stringify(data));
                    },
                    500: function(data) {
                        console.log(JSON.stringify(data));
                    }
                }
            });
        }
        // Flips between regular and shiny images
        function showImage(type) {
            var photoEle = $('#imageOfPokemon');
            var image;
            switch (type) {
                case 'default' : {
                    image = sprites["frontDefault"];
                    if (image === null) {
                        image = "/images/pokeball1.png";
                    }
                    break;
                }
                case 'shiny' : {
                    image = sprites["frontShiny"];
                    if (image === null) {
                        image = "/images/pokeball1.jpg";
                    }
                    break;
                }
                default : {
                    image = "/images/pokeball1.png";
                    break;
                }
            }
            photoEle.prop("src", image);
            //$('#imageAndImageBtns').style.backgroundImage = photoEle;
            photoEle.show();
        }
        // Ajax to get the color of the Pokemon
        function changeBackgroundColor(name) {
            $.ajax({
                type: "GET",
                url: "/pokedex/"+name+"/color",
                async: false,
                dataType: "application/json",
                crossDomain: true,
                statusCode: {
                    200: function(data) {
                        //console.log("background color: " + data.responseText);
                        var color = data.responseText;
                        if (color === "red") { color = "#fa8072"; }
                        else if (color === "yellow") { color = "#FFC300"; }
                        else if (color === "green") { color = "#AFE1AF"; }
                        else if (color === "blue") { color = "#ADD8E6"; }
                        else if (color === "purple") { color = "#CBC3E3"; }
                        else if (color === "brown") { color = "#D27D2D"; }
                        document.body.style.backgroundColor = color;
                        $('#colorOfPokemon').text(data.responseText);
                        if (data.responseText === "black") {
                            var nameLabelEle = document.getElementById("nameLabel");
                            nameLabelEle.style.color = "white";
                            var infoTitleEle = document.getElementById("infoTitle");
                            infoTitleEle.style.color = "white";
                            var titleEle = document.getElementById("title");
                            titleEle.style.color = "white";
                            var infoEle = document.getElementById("info");
                            infoEle.style.color = "white";
                        } else {
                            var nameLabelEle = document.getElementById("nameLabel");
                            nameLabelEle.style.color = "black";
                            var infoTitleEle = document.getElementById("infoTitle");
                            infoTitleEle.style.color = "black";
                            var titleEle = document.getElementById("title");
                            titleEle.style.color = "black";
                            var infoEle = document.getElementById("info");
                            infoEle.style.color = "black";
                        }
                    },
                    400: function(data) {
                        console.log("color 400: " + data.responseText);
                    }
                }
            });
        }
        // Determines if the input is valid or not
        function isNameValid(name) {
            var result = false;
            $.ajax({
                type: "GET",
                url: "/pokedex/"+name+"/validateName",
                async: false,
                dataType: "application/json",
                crossDomain: true,
                statusCode: {
                    200: function() {
                        result = true;
                    },
                    400: function() {
                        result = false;
                    }
                }
            });
            return result;
        }
    </script>
</body>

</html>