<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
<head>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="icon" type="image/x-icon" href="/images/pokeball.jpg"/>
    <title>Pokedex</title>
    <style>
        html {
            <!-- background-image: url(); -->
            background-position: center center;
            background-repeat:  no-repeat;
            background-attachment: fixed;
            background-size:  cover;
        }
        <!-- NEEDED -->
        body {
            display: block;
            margin: 8px;
            background-position: center center;
            background-repeat:  no-repeat;
            background-attachment: fixed;
            background-size:  cover;
        }
        .button {
            font-weight: bold;
        }
        .cursor {
            cursor:pointer;
        }
        .center {
            padding: 70px 0;
            text-align: center;
            vertical-align: middle;
        }
        h1 {
            /*padding: 70px 0;*/
            text-align: center;
            line-height: 1.5;
            display: inline-block;
            vertical-align: middle;
        }
        /* Style the tab */
        .tab {
            overflow: hidden;
            border: 1px solid #ccc;
            background-color: #f1f1f1;
        }

        /* Style the buttons that are used to open the tab content */
        .tab button {
            background-color: inherit;
            float: left;
            border: none;
            outline: none;
            cursor: pointer;
            padding: 14px 16px;
            transition: 0.3s;
        }

        /* Change background color of buttons on hover */
        .tab button:hover {
            background-color: #ddd;
        }

        /* Create an active/current tablink class */
        .tab button.active {
            background-color: #ccc;
        }

        /* Style the tab content */
        .tabcontent {
            display: none;
            padding: 6px 12px;
            border: 1px solid #ccc;
            border-top: none;
        }
    </style>
    <!-- jQuery -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
    <link rel="stylesheet" href="//code.jquery.com/ui/1.12.1/themes/base/jquery-ui.css">
    <script src="https://code.jquery.com/ui/1.12.1/jquery-ui.js"></script>
    <!-- Latest compiled and minified CSS -->
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/3.4.1/css/bootstrap.min.css">
    <!-- Optional theme -->
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/3.4.1/css/bootstrap-theme.min.css">
    <!-- Latest compiled and minified JavaScript -->
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/3.4.1/js/bootstrap.min.js"></script>
    <!-- JavaScript Bundle with Popper -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.0/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-gH2yIJqKdNHPEq0n4Mqa/HGKIhSkIHeL5AyhkYV8i59U5AR6csBvApHHNl/vI1Bx" crossorigin="anonymous">
</head>

<body style="justify-content:space-evenly;text-align: center;">
    <h1 id="title" style="vertical-align: middle;">
        This is your
        <span class="center"><img alt="pokedex" src="/images/pokedexImage.jpg" height=150></span>
    </h1>
    <br>
    <h4 style="vertical-align: middle;">
        <label id="nameLabel" for="pokemonName">Pokemon Name/ID</label> <input id="pokemonName" type="text"/>
        <input id="pokemonBtn" type="button" onclick="getPokemonInfo();" class="button cursor" value="Get Info"/>
        <input id="pokemon" type="hidden"/>
    </h4>
    <br>
    <div id="pokedex" style="display:inline-flex;">
        <div style="display:flow;">
            <h1 id="infoTitle">Pokemon Info</h1>
            <div id="info" style="display:flow; width:300px;">
                <div id="idAndName" style="display:inline-flex;">
                    <label for="idOfPokemon">ID:</label> <h3 id="idOfPokemon"></h3> &nbsp;
                    <label for="nameOfPokemon">Name:</label> <h3 id="nameOfPokemon"></h3>
                </div>
                <br>
                <div id="hAndW" style="display:inline-flex;">
                    <label for="heightOfPokemon">Height:</label> <h3 id="heightOfPokemon"></h3> &nbsp;
                    <label for="weightOfPokemon">Weight:</label> <h3 id="weightOfPokemon"></h3>
                </div>
                <br>
                <div id="colorAndType" style="display:inline-flex;">
                    <label for="colorOfPokemon">Color:</label> <h3 id="colorOfPokemon"></h3> &nbsp;
                    <label for="typeOfPokemon">Type:</label> <h3 id="typeOfPokemon"></h3>
                </div>
                <!-- Tab links -->
                <div class="tabs">
                    <button class="tab" onclick="showDivAndBoldText(this, 'descriptionDiv');">Description</button>
                    <button class="tab" onclick="showDivAndBoldText(this, 'locationDiv')">Location</button>
                    <button class="tab" onclick="showDivAndBoldText(this, 'movesDiv')">Moves</button>
                    <button class="tab" onclick="showDivAndBoldText(this, 'berriesDiv')">Berries</button>
                </div>
                <br>
                <div id="descriptionDiv">
                    <h3 id="description"></h3>
                </div>
                <div id="locationDiv" style="overflow: scroll; height:75px;">
                    <h3 id="location"></h3>
                </div>
                <div id="movesDiv">
                    <h3 id="moves">Moves of Pokemon</h3>
                </div>
                <div id="berriesDiv">
                    <h3 id="berries"> Berries edible by Pokemon</h3>
                </div>
            </div>
            <br>
            <div id="imageAndImageBtns">
                <div id="photosDiv">
                    <input id="pokemonDefaultImgBtn" type="button" onclick="showImage('default');" class="button cursor" value="Show default"/>
                    <input id="pokemonShinyImgBtn" type="button" onclick="showImage('shiny');" class="button cursor" value="Show shiny"/>
                </div>
                <img id="imageOfPokemon" alt="pokemon" src="#" width="300" height="300"/>
            </div>
        </div>
    </div>
    <script type="text/javascript">
        $(function(){
            $('#pokedex').hide();
        });
        let pokemon = {}, sprites = {};
        let locations = [];
        let desc = "", color = "";
        // Actions performed when you click "Get Info"
        function getPokemonInfo() {
            let name = $('#pokemonName').val();
            name = name.toLowerCase();
            if (!isNameValid(name)) { alert("Not a valid name or ID"); }
            else {
                pokemon = getPokemon(name);
                //console.log("pokemon set: " + JSON.stringify(pokemon));
                sprites = JSON.parse(pokemon)["sprites"];
                //console.log("sprites set: " + JSON.stringify(sprites));
                desc = getPokemonDescriptionText(name);
                locations = getLocations(name);
                color = setBackgroundAndGetColor(name);
                setupPokedex();
                showImage('default');
                $('#descriptionDiv').show();
                $('#locationDiv').hide();
                $('#movesDiv').hide();
                $('#berriesDiv').hide();
                $('#pokedex').show();
            }
        }
        // Ajax to get Pokemon
        function getPokemon(name) {
            pokemon = $.ajax({
                type: "GET",
                url: "/pokedex/pokemon/"+name,
                async: false,
                dataType: "application/json",
                'success': function(data) {
                    pokemon = JSON.parse(data.responseText);
                }
            });
            return pokemon.responseText;
        }
        // Ajax to get Locations
        function getLocations(name) {
            $.ajax({
                type: "GET",
                url: "/pokedex/locations/"+name,
                async: false,
                crossDomain: false,
                'success': function(data) {
                    locations = JSON.parse(data);
                    console.log("length: " + locations.length + " locations: " + locations);
                    let locationText = [];
                    for(let i=0; i<locations.length; i++) {
                        locationText.push(locations[i]);
                    }
                    locations = locationText;
                    console.log("after: " + locations);
                }
            });
            return locations;
        }
        // Ajax to get Description text
        function getPokemonDescriptionText(name) {
            desc = $.ajax({
                headers: {
                    accept: "application/json",
                    contentType: "application/json"
                },
                type: "GET",
                url: "pokedex/"+name+"/description",
                async: false,
                dataType: "application/json",
                crossDomain: false,
                'success': function(data) {
                    desc = JSON.parse(data.responseText);
                }
            });
            return desc.responseText;
        }
        // Flips between regular and shiny images
        function showImage(type) {
            var photoEle = $('#imageOfPokemon');
            var image;
            switch (type) {
                case 'default' : {
                    image = sprites["frontDefault"];
                    if (image === null) {
                        image = "/images/pokeball1.png";
                    }
                    break;
                }
                case 'shiny' : {
                    image = sprites["frontShiny"];
                    if (image === null) {
                        image = "/images/pokeball1.jpg";
                    }
                    break;
                }
                default : {
                    image = "/images/pokeball1.png";
                    break;
                }
            }
            photoEle.prop("src", image);
            //$('#imageAndImageBtns').style.backgroundImage = photoEle;
            photoEle.show();
        }
        // Ajax to get the color of the Pokemon
        function setBackgroundAndGetColor(name) {
            $.ajax({
                type: "GET",
                url: "/pokedex/"+name+"/color",
                async: false,
                crossDomain: false,
                'success': function(data) {
                    let colorRes = JSON.stringify(data).replaceAll("\"", "");
                    console.log("color before: " + colorRes);
                    if (colorRes === "red") { document.body.style.backgroundColor = "#FA8072"; }
                    else if (colorRes === "yellow") { document.body.style.backgroundColor  = "#FFC300"; }
                    else if (colorRes === "green") {
                        document.body.style.backgroundColor  = "#AFE1AF";
                        console.log("colorRes: " + colorRes);
                    }
                    else if (colorRes === "blue") { document.body.style.backgroundColor  = "#ADD8E6"; }
                    else if (colorRes === "purple") { document.body.style.backgroundColor  = "#CBC3E3"; }
                    else if (colorRes === "brown") { document.body.style.backgroundColor  = "#D27D2D"; }
                    else if (colorRes === "white") { document.body.style.backgroundColor  = "#d3cbcb"; }
                    if (data.responseText === "black") {
                        var nameLabelEle = document.getElementById("nameLabel");
                        nameLabelEle.style.color = "white";
                        var infoTitleEle = document.getElementById("infoTitle");
                        infoTitleEle.style.color = "white";
                        var titleEle = document.getElementById("title");
                        titleEle.style.color = "white";
                        var infoEle = document.getElementById("info");
                        infoEle.style.color = "white";
                    }
                    else {
                        var nameLabelEle = document.getElementById("nameLabel");
                        nameLabelEle.style.color = "black";
                        var infoTitleEle = document.getElementById("infoTitle");
                        infoTitleEle.style.color = "black";
                        var titleEle = document.getElementById("title");
                        titleEle.style.color = "black";
                        var infoEle = document.getElementById("info");
                        infoEle.style.color = "black";
                    }
                    console.log("colorRes: " + colorRes);
                    color = colorRes;
                }
            });
            console.log("color after: " + color);
            return color;
        }
        // Sets the text fields
        function setupPokedex() {
            pokemon = JSON.parse(pokemon);
            $('#idOfPokemon').text(pokemon.id);
            $('#nameOfPokemon').text(pokemon.name.charAt(0).toUpperCase() + pokemon.name.slice(1));
            $('#heightOfPokemon').text(pokemon.height);
            $('#weightOfPokemon').text(pokemon.weight);
            $('#colorOfPokemon').text(color);
            let pokemonTypes = pokemon["types"];
            if (pokemonTypes.length > 1) {
                $('#typeOfPokemon').text(pokemonTypes[0].type.name + " and " + pokemonTypes[1].type.name);
            }
            else {
                $('#typeOfPokemon').text(pokemonTypes[0].type.name);
            }
            $('#description').text(desc);

            console.log(locations.length + " before location text adding");
            $('#locationDiv').html("");
            if (locations.length === 0) {
                $('#locationDiv').append("<h3 id=\"location\">No known locations!</h3>");
            }
            else {
                for(let i=0; i<locations.length; i++) {
                    $('#locationDiv').append("<ul><h3 id=\"location"+i+"\">"+locations[i]+"</h3></ul>");
                }
            }
        }
        // Determines if the input is valid or not
        function isNameValid(name) {
            var result = false;
            $.ajax({
                type: "GET",
                url: "/pokedex/"+name+"/validateName",
                async: false,
                dataType: "application/json",
                crossDomain: true,
                statusCode: {
                    200: function() {
                        result = true;
                    },
                    400: function() {
                        result = false;
                    }
                }
            });
            return result;
        }
        // Shows the div based on the tab click
        function showDivAndBoldText(button, div) {
            if (div === "descriptionDiv") {
                $('#descriptionDiv').show();
                $('#locationDiv').hide();
                $('#movesDiv').hide();
                $('#berriesDiv').hide();
            }
            else if (div === "locationDiv") {
                $('#descriptionDiv').hide();
                $('#locationDiv').show();
                $('#movesDiv').hide();
                $('#berriesDiv').hide();
            }
            else if (div === "movesDiv") {
                $('#descriptionDiv').hide();
                $('#locationDiv').hide();
                $('#movesDiv').show();
                $('#berriesDiv').hide();
            }
            else if (div === "berriesDiv") {
                $('#descriptionDiv').hide();
                $('#locationDiv').hide();
                $('#movesDiv').hide();
                $('#berriesDiv').show();
            }
        }
    </script>
</body>

</html>